# react native와 firebase, typescript를 연동해서 SNS APP 만들기.

파이어베이스 v8.2.3을 사용했다. 최초에는 최신 버전을 이용했지만, 필요한 모듈에 타입이 정의가 안 된 경우가 있었고, 무엇보다 문서화가 이전 버전에 비해 부실하다는 느낌이 들어서 그냥 이전 버전을 사용했다. 어지간하면 그냥 최신 버전 공부도 겸한다는 생각으로 했을텐데, 타입이 정의되지 않은 부분을 직접 타입을 적어가면서 프로젝트를 진행한다면 너무 오래걸릴 것 같고 쉬운 일도 아니라는 판단이 들었다. 결국에 프로젝트를 진행하던 도중에 버전을 다운그레이드 했고, 한 번 크게 수정했다.

현재까지 구현된 부분은 로그인 로그아웃, 회원가입, 메인화면에 네비게이션 바텀 바를 이용해서 화면을 전환하는 기능, 팔로우 언팔로우, 사용자 검색, 사용자 프로파일, expo-camera를 이용한 사진 캡쳐 및 파이어베이스 데이터베이스에 저장, 포스트 좋아요 기능 (포스트 좋아요는 파이어베이스에서 요금제 업그레이드를 해야할 것 같아서 뼈대 정도만 만들어두고 나중에 대대적으로 CSS를 수정할 때 같이 포함해보려 한다.) 정도가 될 것 같다. 주로 유저 데이터를 만들고 지우고 받아오는 작업들은 리덕스와 리덕스 thunk를 이용했다. 이 외에도 시행착오로 만들어진 파일과 폴더들이 많아서 리팩토링 해야할 것들이 있는데, 다른 일도 많고 이 프로젝트만 진행할 순 없기에, 차후에 진행하도록 하려한다.

## 파이어베이스

파이어베이스는 내가 직접 백엔드에 투자해야할 시간들을 많이 줄여준다는 장점이 있고 사용법만 안다면 크게 어렵지않게 프로젝트를 진행할 수 있어서 사용했다. 문제는 버전에 따른 typescript 호환이 조금 안되는 것 같았다. 최신 버전을 이용할 때 사용해야할 기능들이 타입문제로 막히는 경우가 있었고, 어떻게든 해결해보려고 몇 시간을 삽질 했지만 결국에는 해결하지 못했다. 제일 좋은 해결 방법은 일일이 필요한 부분에 타입을 정해주는 것인데, 이건 너무 힘들것 같아서 차라리 안정적인 다른 버전을 사용하자는 결정을 내렸다. 문제는 버전이 달라지면 사용하는 방법도 달라지기에, 프로젝트 대부분을 수정했다. 긍정적으로 최신 버전도 공부했고, 로우 버전에서 사용법도 알게되었기에 차라리 잘된 편이다.

## 기능

### 회원가입 및 로그인 로그아웃

회원가입과 로그인 로그아웃 기능을 구현하기 위해서 Authentication을 이용했다. auth()의 onAuthStateChanged를 이용해서 가장 처음 메인이 되는 화면에서 로그인 혹은 회원가입을 해서 onAuthStateChanged의 프로퍼티 값이 트루 혹은 폴스일 경우에 화면을 조건부 렌더링 했다. 따라서 로그인을 성공하거나 회원가입에 성공할 시에, 최초에 기본 로그인화면과 회원가입만 보이던 화면에서 Feed가 메인으로 보이는 화면으로 넘어간다. App의 state와 파이어베이스 인증의 기능을 사용해서 구현한 것이다.

### 카메라

이제 메인 기능들을 만들기 위해서 components라는 폴더에 Main이라는 폴더를 따로 만들어서 메인에 해당하는 모든 기능과 화면들을 넣어놨다. 앞으로 메인 기능을 수정할 일이 있다면 이 곳에서만 수정하면 된다. 처음으로 구현한 것은 카메라 기능이었다. expo-camera라는 라이브러리를 사용해서 구현했는데, 문서에 주어진 그대로를 거의 사용했기 때문에 수정할 것들이 별로 없었다. 화면을 가르키는 컴포넌트는 Add.tsx다. 필요할 것 같은 버튼 네 가지가 있다. 전면 카메라와 후면 카메라 기능을 이용하기 위해서 flip 버튼이 있고, 갤러리에서 필요한 사진을 가져올 수 있는 기능도 있다. 그리고 사진을 촬영하기 위한 take picture 버튼이 있고, 촬영한 사진을 내 파이어베이스 데이터베이스에 저장할 수 있는 save 버튼이 있다. save버튼을 누른다면 사진에 대한 추가 내용을 작성할 수 있고, 저장 버튼이 있는 화면으로 넘어간다.

이 부분은 이제 적절한 CSS로 잘 꾸며주면 될 것이다. 추가적으로 더 해줄 부분이 있다면, 갤러리에서 사진을 픽해오는 기능이 완벽하지 않기 때문에 보완해야하고, 나이트메어 기능으로 사진에 필터를 넣어주는 기능이 있으면 화려할 것 같다.

### 사용자 프로파일

인스타그램의 프로파일을 보면, 핸드폰 기준에서 네모나게 이미지가 3줄로 나열되있는 것을 확인할 수 있는데, 그대로 가져왔다. 프로파일의 화면을 가르키는 컴포넌트는 Profile.tsx이다. 이 부분에서 다른 사용자의 프로파일에 들어가는 것과 내 프로파일에 내가 들어가는 것을 구분해서 로직을 구현했다. 만약에 내가 내 프로파일에 들어간다면 팔로우 언팔로우 버튼이 있어야 할 부분에 로그아웃 버튼이 있다. 다른 이용자의 프로파일에 들어간다면 그 즉시 파이어베이스에서 그 유저의 정보를 이용해서 다른 이용자가 가지고 있는 포스트와 유저 정보를 가져오고 렌더링한다. 팔로우 팔로잉은 Profile.tsx의 스테이트와 파이어베이스의 데이터베이스에 내용을 응용해서 구현했다. 간단하게 적어놓자면 내가 이 사람을 팔로우 했다면 버튼이 팔로잉으로 바뀌고 그 정보가 기억되서 나중에 들어와도 버튼이 팔로잉으로 바뀌어져 있다.

좀 더 자세하게 적어보면 파이어베이스에서 나의 팔로잉이라는 컬렉션에서 나의 정보에 해당하는 문서를 열어보면 내가 팔로우 해놓은 사람들의 정보가 담겨있는데, 앱 화면상에 어떤 사람의 프로파일로 들어갔을 때, 이 사람의 정보가 내가 팔로우 해놓은 사람들의 정보에 exists 한다면 Profile이라는 컴포넌트의 state중 following이라는 boolean state가 true가 된다. 위에 적혀있는 글과 동일한 내용이다.

### 피드

최초에 로그인에 성공한다면 피드 화면을 곧바로 볼 수가 있다. 이 피드 화면에 나오는 데이터들은 모두 내가 팔로우한 대상이 올린 사진 및 작성한 글들만을 볼 수가 있다. 크게 두 가지 기능이 있는데, 좋아요 기능과 댓글 기능이다. 좋아요는 버튼을 클릭할 시에 숫자가 카운트 되게끔 만들어야 하는데 이 부분에서 파이어베이스 요금제를 업그레이드 해야할 것 같아서 일단 보류해놨다. 댓글 보기라는 텍스트를 클릭하면 해당 포스트에 댓글을 달 수 있는 화면으로 넘어가고 그 포스트에 있는 모든 댓글들을 볼 수 있다. 다만 사진을 같이 넘기지 않았기에, 댓글만 볼 수 있는 심심한 화면인데, 차후에 사진과 같이 넘기고 이 부분에서도 좋아요 기능과 다양한 옵션을 추가해서 꾸며볼 예정이다.

### 검색

검색기능은 다른 유저의 아이디를 찾을 수 있는 기능이다. 만약에 admin이라는 유저가 있다고 보면 a만 쳐도 admin이라는 사용자가 검색창에 나오게 된다. 지금은 만들어놓은 유저가 몇 명 없어서 모두 나오게끔 설정을 해놨지만, 만약에 사용자가 1억명이라는 가정을 두게 된다면 a로 시작하는 유저가 화면에 모두 나오게되기에 수정이 필요한 부분이다. 우선 지금은 서치앤 무브를 중점적으로 만들어 봤기에 저 작업도 차후로 밀렸다. 이제 검색해서 내가 원하는 사용자를 클릭하면 그 유저의 프로파일로 화면이 전환된다. 이 부분은 사용자 프로파일에서 같이 다뤘기에 생략하겠다.

대충 이 정도가 구현이 된 것 같은데, 솔직히 CSS는 거의 만지지 않아서 날 것 그대로의 화면이다. 일단 개인 포트폴리오 사이트 제작을 가장 우선순위로 올렸기에, 먼저 한 후에 여러가지 수정을 하고 수정사항을 이 파일에 작성하겠다.
